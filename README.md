# Nodechestra
## Description
*Nodechestra* is a participative motion-based online synthesizer, harnessing real-time web communication to engage multiple users in collaborative virtual sound-making. This project is inspired by the seemingly ineluctable societal progression of dematerialization - amplified by recent pandemic times - and seeks to create space for reembodied collective online play.

*Nodechestra* is played by users from their web browser, communicating with an ad hoc [Max/MSP](https://cycling74.com/products/max) patch via a Node application.
The application provides an HTTP server built using Express, and implements WebSocket to enable bidirectional communication between server and client. Following the initial HTTP handshake, the client sends data generated by UI interaction to the server, which pipes the data to Max/MSP via the relevant Node API and a Max Node scripting object. This data is then routed to the Max/MSP synthesizer, modulating its parameters.

The synthesizerâ€™s function is broken down into a set number of parameters (voice frequency, envelope characteristics, reverb, etc..), which are semi-randomly parceled out to various client pages. The user triggers parameter changes using interactive elements of the served page, the nature of which depends on their attributed parameter.

## Parameters

| name        | function                  | detail  | tool                                 
| -           | -                         | -       | -                                     
|             |                           |         |                                       
| bass        | bass choral voice         |  mouth  | Y: frequency  / open: trigger         
| baritone    | baritone choral voice     |  mouth  | Y: frequency  / open: trigger         
| tenor       | tenor choral voice        |  mouth  | Y: frequency  / open: trigger         
| contralto   | contralto choral voice    |  mouth  | Y: frequency  / open: trigger         
| mezzo-sop   | mezzo-sop choral voice    |  mouth  | Y: frequency  / open: trigger         
| soprano     | soprano choral voice      |  mouth  | Y: frequency  / open: trigger         
|             |                           |         |                                       
| waveform    | waveform panning          |  hands  | RX: continuous / LX: discrete         
| envelope    | envelope parameters       |  hands  | LY: A / LY: D / RY: S / RX: R         
|             |                           |         |                                       
| noise       | noise parameters          |  hands  | RY: amt / LX: colour                  
| delay       | delay parameters          |  hands  | RY: amt / LX: time                    
| reverb      | reverb parameters         |  pose   | Lsh amt / Lin dec / Rin dam / Rsh diff
|             |                           |         |                                       
| filter      | filter parameters         |  hands  | RY: amt / LX: freq / LY: resonance    
| envelope    | envelope parameters       |  hands  | LY: A / LY: D / RY: S / RX: R         
|             |                           |         |                                       
| arpeggiator | arpeggiator parameters    |  hands  | RY: duty / LX: rate                              
|             |                           |         |                              

## Instructions
1. Download [project folder](https://github.com/ylliez/nodechestra) from GitHub
2. Download [Max/MSP application](https://cycling74.com/downloads) (no need for subscription)
3. Open `nodechestra.maxpat` file
4. Start Node script
5. Turn on DAC
6. Launch webpage
7. Access parameters

## UI
### Inspo
- [Virtual Synth](https://virtual-synth.netlify.app/)/[GH](https://github.com/gauthammk/Virtual-Synth)
- [Web Audio API synth](https://www.dabbmedia.com/web-audio/synth/)/[GH](https://github.com/dabbmedia/web-audio-synth)

## Resources
### ML
[MediaPipe](https://google.github.io/mediapipe/)
[Hands](https://google.github.io/mediapipe/solutions/hands)
[Face mesh landmarks](https://mediapipe.dev/images/mobile/hand_landmarks.png)
[Hands Codepen](https://codepen.io/mediapipe/pen/RwGWYJw)

[Face Mesh](https://google.github.io/mediapipe/solutions/face_mesh)
[Face mesh landmarks](https://github.com/google/mediapipe/blob/master/mediapipe/modules/face_geometry/data/canonical_face_model_uv_visualization.png)

[Pose](https://google.github.io/mediapipe/solutions/pose)
[Pose landmarks](https://mediapipe.dev/images/mobile/pose_tracking_full_body_landmarks.png)
[Pose Codepen](https://codepen.io/mediapipe/pen/jOMbvxw)


### [Vocal Ranges](https://www.wikidoc.org/index.php/Vocal_range) & [MIDI equivalents](https://www.inspiredacoustics.com/en/MIDI_note_numbers_and_center_frequencies)
| CHORAL | note | MIDI | # |  
| - | - | - | - |
Soprano | C4-A5 | 60-81 | 22
Mezzo-Soprano | A3-F5 | 57-77 | 21
Contralto | F3-D5 | 53-74 | 22
Tenor | B2-G4 | 47-67 | 21
Baritone | G2-E4 | 43-64 | 22
Bass/Basso | E2-C4 | 40-60 | 21

| OPERATIC | note | MIDI | # |  
| - | - | - | - |            
Soprano | C4-C6 | 60-84 | 25
Mezzo-Soprano | A3-A5 | 57-81 | 25
Contralto | E3-E5 | 52-76 | 25
Tenor | C3-C5 | 48-72 | 25
Baritone | G2-G4 | 43-67 | 25
Bass | E2-E4 | 40-64 | 25                          

### Other
- [CSS toggle switch](https://www.w3schools.com/howto/howto_css_switch.asp) --> irrelevant
- [favicon](https://icon-icons.com/icon/perfect-circle/53928)

## Deployment
### Heroku
- Heroku set-up, tie repo & deploy --> NO : crash, issue with package.json start script ==> change to server script
- retest (& try in VSC terminal) -> NO : crash; issue w/ max-api usage --> try [max-api-or-not](https://github.com/dimitriaatos/max-api-or-not)
- retest --> NO : crash, "Web process failed to bind to $PORT within 60 seconds of launch" ; just too slow
- retest --> NO : still slow error despite build "succeeded" & "deploy" awa attempt to open app & access local host...
- retest --> NO : still crash -->

- 12/02: Deployed but H14 (no web processes running) --> subscribe to Eco Dynos & scale project dynos to 1 (https://devcenter.heroku.com/articles/scaling)

#### info
[error codes](https://devcenter.heroku.com/articles/error-codes)
[dynos](https://devcenter.heroku.com/articles/dynos)


## Issues
- [x] function distribution --> OK : resolved by socket.io implementation
- disconnect crash --> OK : resolved by socket.io implementation
- s2c GUI value change --> NO : irrelevant due to compartmentalization
- s2c audio feed --> NO : AFAIK not possible
- ML control --> OK : in process of implementation/debugging
- Data control? --> TBD
- Actual client network access --> TBD (Heroku deployment of GitHub repo) ==> CSC

- routing : express routes &&/|| socket.io namespaces
- namespaces vs. rooms
- attributing/serving pages
- procedurally generating HTML/JS pages : [EJS](https://ejs.co/)? React/Vue?
    - Vue & IO:
        - https://www.npmjs.com/package/vue-socket.io
        - https://deepinder.me/creating-a-real-time-chat-app-with-vue-socket-io-and-nodejs
        - https://blog.openreplay.com/rendering-real-time-data-with-vue-node-and-socket-io
    - React & IO:
        - https://www.freecodecamp.org/news/build-a-realtime-chat-app-with-react-express-socketio-and-harperdb/

- clamp values? ([link1](https://www.webtips.dev/webtips/javascript/how-to-clamp-numbers-in-javascript), [link2](https://stackoverflow.com/questions/11409895/whats-the-most-elegant-way-to-cap-a-number-to-a-segment))
- draw UI elements of MediaPipe 
    - lips: https://github.com/google/mediapipe/issues/2040

- Max/MSP client connection:
```
const io = require("socket.io-client");
// const socket = io('http://localhost:4200');
// const socket = io("https://nodechestra.herokuapp.com/");
// const socket = io.connect('https://nodechestra.herokuapp.com');
// const socket = io("/max").connect('https://nodechestra.herokuapp.com');
const socket = io("https://nodechestra.herokuapp.com/max");
```

Node modules on 